!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n=io.connect("//"+document.domain+":"+location.port),o=0,i=document.getElementById("canvas");i.addEventListener("contextmenu",function(e){e.preventDefault()},!1);var r=i.getContext("2d");window.innerWidth<500&&(i.width=270,i.height=290);var c=i.width/2,l=i.height/2,a=0,d=old_cx=0,f=old_cy=0,s=old_dir=0,h=0,m=0,v=new Image;v.src="static/tilesheet.png";var p=new Image;p.src="static/charsheet.png";var _=[],g={};r.font="11pt Verdana",r.textAlign="end";var w=i.clientWidth,k=i.clientHeight-20;function b(){for(r.clearRect(0,0,i.width,i.height),x=0;x<w;x+=a){var e=x/a+(d-h);for(y=0;y<k;y+=a)if(tile=_[y/a+(f-m)][e],Array.isArray(tile))for(var t in tile)E(tile[t],x,y);else E(tile,x,y)}!function(){for(u in g)u!=o&&(ucx=g[u].cx,ucy=g[u].cy,x=ucx-d,y=ucy-f,x>=-h&&x<=h&&y>=-m&&y<=m&&S(x+h,y+m,g[u].direction))}(),p.complete?S(h,m,s):p.addEventListener("load",S),r.fillStyle="white",r.fillRect(0,i.height-20,i.width,20),r.strokeText("("+d+", "+f+")",14*a+30,15*a+15)}function E(e,t,n){r.beginPath(),v.complete?O(e,t,n):v.load=O.bind(e,t,n),r.moveTo(t,n),r.lineTo(t+a,n),r.moveTo(t,n),r.lineTo(t,n+a),r.stroke(),r.closePath()}function S(e,t,n){r.strokeStyle="transparent",r.drawImage(p,n*a,0,a,a,e*a,t*a,a,a)}function O(e,t,n){r.strokeStyle="transparent",r.drawImage(v,e%10*a,Math.floor(e/10)*a,a,a,t,n,a,a)}function L(e){[32,37,38,39,40,65,68,69,83,87].includes(e.keyCode)&&(e.preventDefault(),D(),P(),32==e.keyCode?console.log("Eventually we will implement the spacebar for interacting with items below your character."):69==e.keyCode&&console.log("Eventually we will implement the 'e' key for interacting with nearby npcs and objects, if your player is facing them!"),n.emit("json",JSON.stringify({user:o,action:e.keyCode})))}function C(e){click_x=e.offsetX,click_y=e.offsetY,mid_offset=15,mid_low=c-mid_offset,mid_high=c-mid_offset,j(4,[mid_low,mid_high,mid_high,mid_low],[mid_low,mid_low,mid_high,mid_high],click_x,click_y)?L({keyCode:32,preventDefault:function(){}}):j(3,[0,c,i.width],[0,l,0],click_x,click_y)?L({keyCode:38,preventDefault:function(){}}):j(3,[0,c,i.width],[i.height,l,i.height],click_x,click_y)?L({keyCode:40,preventDefault:function(){}}):j(3,[0,c,0],[0,l,i.height],click_x,click_y)?L({keyCode:37,preventDefault:function(){}}):j(3,[i.width,c,i.width],[0,l,i.height],click_x,click_y)&&L({keyCode:39,preventDefault:function(){}}),i.addEventListener("mouseup",P),i.addEventListener("touchend",P)}function j(e,t,n,o,i){var r,c,l=!1;for(r=0,c=e-1;r<e;c=r++)n[r]>i!=n[c]>i&&o<(t[c]-t[r])*(i-n[r])/(n[c]-n[r])+t[r]&&(l=!l);return l}function D(){document.removeEventListener("keydown",L),document.addEventListener("keydown",L)}function P(){i.removeEventListener("mousedown",C),i.removeEventListener("touchstart",C),i.removeEventListener("mouseup",P),i.removeEventListener("touchend",P),i.addEventListener("mousedown",C),i.addEventListener("touchstart",C)}!function(){function e(t){if(n)t-start>100&&b();else{var n=t;b()}requestAnimationFrame(e)}n.on("connect",function(){D(),P()}),n.on("init_data",function(t){t=JSON.parse(t),o=t[0],d=t[1][0],f=t[1][1],s=t[1][2],_=t[2].map,a=t[3][0],i.width<450?(h=4,m=4):(h=t[3][1],m=t[3][2]),e()}),n.on("tiles",function(e){JSON.parse(e)}),n.on("map_data",function(e){e=JSON.parse(e)}),n.on("movement_self",function(e){var t;e=JSON.parse(e),o==e.user&&(t=e,old_cx=d,old_cy=f,old_dir=s,d=t.cx,f=t.cy,s=t.direction)}),n.on("update_all",function(e){g=JSON.parse(e)}),n.on("failure",function(e){console.log("Unsynchronized.")})}()}]);